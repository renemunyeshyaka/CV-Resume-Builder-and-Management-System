(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[464],{7112:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login-otp",function(){return r(6862)}])},6862:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var a=r(5893),o=r(7294),s=r(7066),i=r(1664),l=r.n(i),n=r(1163);let d="http://localhost:4000";function u(){let e=(0,n.useRouter)(),[t,r]=(0,o.useState)(1),[i,u]=(0,o.useState)(""),[p,c]=(0,o.useState)(""),[b,h]=(0,o.useState)(""),[x,m]=(0,o.useState)(""),[y,g]=(0,o.useState)(""),[f,v]=(0,o.useState)(!1),[w,j]=(0,o.useState)({}),[S,P]=(0,o.useState)(!1),[T,k]=(0,o.useState)(1),[E,C]=(0,o.useState)(""),[O,D]=(0,o.useState)(""),[q,_]=(0,o.useState)(""),[W,R]=(0,o.useState)(""),[B,N]=(0,o.useState)(!1),z=()=>{let e={},t=i.trim();return t?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(e.email="Invalid email address."):e.email="Email is required.",p?p.length<6&&(e.password="Password must be at least 6 characters."):e.password="Password is required.",e},I=()=>{let e={},t=x.trim();return t?/^\d{6}$/.test(t)||(e.otp="OTP must be 6 digits."):e.otp="OTP is required.",e},Z=()=>{let e={},t=E.trim();return t?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(e.forgotEmail="Invalid email address."):e.forgotEmail="Email is required.",e},A=()=>{let e={};return O.trim()||(e.forgotCode="Code is required."),q?q.length<6&&(e.newPassword="Password must be at least 6 characters."):e.newPassword="New password is required.",e},F=async e=>{e.preventDefault(),g(""),j({});let t=z();if(j(t),!Object.keys(t).length){v(!0);try{let e=await s.Z.post("".concat(d,"/api/auth/login-otp"),{email:i.trim(),password:p});h(e.data.userId),r(2)}catch(e){var a,o;g((null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.error)||"Login failed. Please try again.")}finally{v(!1)}}},L=async t=>{var r,a,o;t.preventDefault(),g(""),j({});let i=I();if(j(i),!Object.keys(i).length){v(!0);try{let t=await s.Z.post("".concat(d,"/api/auth/verify-otp"),{userId:b,otp:x.trim()});localStorage.setItem("token",t.data.token);let a=(null===(r=t.data.user)||void 0===r?void 0:r.role)||t.data.role;"admin"===a?e.push("/admin-dashboard"):"hr"===a||"recruiter"===a?e.push("/hr-dashboard"):e.push("/user-dashboard")}catch(e){g((null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.error)||"OTP verification failed. Please try again.")}finally{v(!1)}}},$=async e=>{e.preventDefault(),R(""),j({});let t=Z();if(j(t),!Object.keys(t).length){v(!0);try{await s.Z.post("".concat(d,"/api/auth/forgot-password"),{email:E.trim()}),R("A reset code has been sent to your email."),k(2)}catch(e){var r,a;R((null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.error)||"Failed to send reset code")}finally{v(!1)}}},V=async e=>{e.preventDefault(),R(""),j({});let t=A();if(j(t),!Object.keys(t).length){v(!0);try{await s.Z.post("".concat(d,"/api/auth/reset-password"),{email:E.trim(),code:O.trim(),newPassword:q}),R("Password reset successful! You can now log in."),N(!0),setTimeout(()=>{P(!1),N(!1),k(1),C(""),D(""),_("")},2e3)}catch(e){var r,a;R((null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.error)||"Failed to reset password")}finally{v(!1)}}},X={container:{maxWidth:400,margin:"60px auto",background:"rgba(255,255,255,0.95)",borderRadius:12,boxShadow:"0 2px 16px #dbeafe",padding:"32px 24px",display:"flex",flexDirection:"column",alignItems:"center"},title:{color:"#2a7ae2",marginBottom:24},form:{width:"100%",display:"flex",flexDirection:"column",gap:16},inputWrapper:{width:"100%"},input:{width:"100%",padding:"10px",borderRadius:6,fontSize:"1rem"},errorText:{color:"#e53e3e",fontSize:"0.9rem",marginTop:4},button:{background:"#2a7ae2",color:"#fff",border:"none",borderRadius:6,padding:"12px",fontWeight:"bold",fontSize:"1.1rem",cursor:"pointer",transition:"background 0.2s"},buttonDisabled:{background:"#b6d4fe",cursor:"not-allowed"},textButton:{background:"none",color:"#2a7ae2",border:"none",textDecoration:"underline",cursor:"pointer",fontSize:"0.98rem"},error:{color:"#e53e3e",marginTop:16},success:{color:"#38a169",marginTop:16,textAlign:"center"},link:{marginTop:24,color:"#2a7ae2",textDecoration:"underline",fontWeight:"bold",fontSize:"1rem"}};return(0,a.jsxs)("div",{style:X.container,children:[(0,a.jsx)("h2",{style:X.title,children:S?"Reset Password":"Login (OTP)"}),1===t&&!S&&(0,a.jsxs)("form",{onSubmit:F,style:X.form,children:[(0,a.jsxs)("div",{style:X.inputWrapper,children:[(0,a.jsx)("input",{type:"email",placeholder:"Email",value:i,onChange:e=>u(e.target.value),style:{...X.input,border:w.email?"1.5px solid #e53e3e":"1px solid #bbb"},"aria-label":"Email","aria-invalid":!!w.email,required:!0}),w.email&&(0,a.jsx)("span",{style:X.errorText,role:"alert",children:w.email})]}),(0,a.jsxs)("div",{style:X.inputWrapper,children:[(0,a.jsx)("input",{type:"password",placeholder:"Password",value:p,onChange:e=>c(e.target.value),style:{...X.input,border:w.password?"1.5px solid #e53e3e":"1px solid #bbb"},"aria-label":"Password","aria-invalid":!!w.password,required:!0}),w.password&&(0,a.jsx)("span",{style:X.errorText,role:"alert",children:w.password})]}),(0,a.jsx)("button",{type:"submit",style:{...X.button,...f&&X.buttonDisabled},disabled:f,children:f?"Sending OTP...":"Send OTP"}),(0,a.jsx)("div",{style:{textAlign:"right",marginTop:8},children:(0,a.jsx)("button",{type:"button",style:X.textButton,onClick:()=>P(!0),children:"Forgot Password?"})})]}),2===t&&(0,a.jsxs)("form",{onSubmit:L,style:X.form,children:[(0,a.jsxs)("div",{style:X.inputWrapper,children:[(0,a.jsx)("input",{type:"text",placeholder:"Enter 6-digit OTP",value:x,onChange:e=>m(e.target.value),maxLength:6,style:{...X.input,border:w.otp?"1.5px solid #e53e3e":"1px solid #bbb"},"aria-label":"OTP","aria-invalid":!!w.otp,required:!0}),w.otp&&(0,a.jsx)("span",{style:X.errorText,role:"alert",children:w.otp})]}),(0,a.jsx)("button",{type:"submit",style:{...X.button,...f&&X.buttonDisabled},disabled:f,children:f?"Verifying...":"Verify OTP"}),(0,a.jsx)("button",{type:"button",style:X.textButton,onClick:()=>r(1),children:"← Back to login"})]}),S&&1===T&&!B&&(0,a.jsxs)("form",{onSubmit:$,style:X.form,children:[(0,a.jsxs)("div",{style:X.inputWrapper,children:[(0,a.jsx)("input",{type:"email",placeholder:"Enter your email",value:E,onChange:e=>C(e.target.value),style:{...X.input,border:w.forgotEmail?"1.5px solid #e53e3e":"1px solid #bbb"},"aria-label":"Email for password reset","aria-invalid":!!w.forgotEmail,required:!0}),w.forgotEmail&&(0,a.jsx)("span",{style:X.errorText,role:"alert",children:w.forgotEmail})]}),(0,a.jsx)("button",{type:"submit",style:{...X.button,...f&&X.buttonDisabled},disabled:f,children:f?"Sending...":"Send Reset Code"}),(0,a.jsx)("button",{type:"button",style:X.textButton,onClick:()=>P(!1),children:"← Back to login"})]}),S&&2===T&&!B&&(0,a.jsxs)("form",{onSubmit:V,style:X.form,children:[(0,a.jsxs)("div",{style:X.inputWrapper,children:[(0,a.jsx)("input",{type:"text",placeholder:"Enter reset code",value:O,onChange:e=>D(e.target.value),style:{...X.input,border:w.forgotCode?"1.5px solid #e53e3e":"1px solid #bbb"},"aria-label":"Reset code","aria-invalid":!!w.forgotCode,required:!0}),w.forgotCode&&(0,a.jsx)("span",{style:X.errorText,role:"alert",children:w.forgotCode})]}),(0,a.jsxs)("div",{style:X.inputWrapper,children:[(0,a.jsx)("input",{type:"password",placeholder:"Enter new password",value:q,onChange:e=>_(e.target.value),style:{...X.input,border:w.newPassword?"1.5px solid #e53e3e":"1px solid #bbb"},"aria-label":"New password","aria-invalid":!!w.newPassword,required:!0}),w.newPassword&&(0,a.jsx)("span",{style:X.errorText,role:"alert",children:w.newPassword})]}),(0,a.jsx)("button",{type:"submit",style:{...X.button,...f&&X.buttonDisabled},disabled:f,children:f?"Resetting...":"Reset Password"})]}),B&&(0,a.jsx)("div",{style:X.success,role:"alert",children:W}),y&&(0,a.jsx)("p",{style:X.error,role:"alert",children:y}),W&&!B&&(0,a.jsx)("p",{style:{...X.error,color:W.includes("successful")?"#38a169":"#e53e3e"},role:"alert",children:W}),(0,a.jsx)(l(),{href:"/",style:X.link,children:"Go back home"})]})}},1163:function(e,t,r){e.exports=r(3079)}},function(e){e.O(0,[66,664,888,774,179],function(){return e(e.s=7112)}),_N_E=e.O()}]);